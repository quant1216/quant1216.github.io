---
title: "Small CLs"
source: https://google.github.io/eng-practices/review/developer/small-cls.html
date: 2020-05-27 09:00:00
categories: basic
---

<h1>단순 번역 및 요약</h1>
<h3>왜 작은 CL을 사용할까요?</h3>
작고 간단한 CL은:

* 리뷰가 빠르게 됩니다. 리뷰어에게 작은 CL을 리뷰 받기 위해 5분을 여러번 사용하는 것은 큰 CL을 리뷰 받기 위해 30분을 쓰는 것보다 쉽습니다.
* 더욱 완벽하게 리뷰됩니다. 변경 사항이 많다면 리뷰어와 저자들은 왔다 갔다 진행되는 설명의 거대한 양에 의해 좌절을 느낍니다. - 때때로 중요한 부분을 놓치거나 잃어버릴 수도 있습니다.
* 버그를 놓칠 확률이 낮아집니다. 당신이 소수의 변화만 만든다면, 당신과 리뷰어 모두, CL의 영향력에 대해 효율적으로 추론할 수 있고 만약 버그가 있다면 쉽게 잡아낼 수 있습니다.
* 만약 거절되도 버려지는 작업이 적습니다. 만약 큰 양의 CL이고 리뷰어가 전체적인 방향성이 틀렸다고 한다면 당신은 많은 작업을 버리게 됩니다.
* Merge하기 쉽습니다. 큰 CL을 작업하는 것은 긴 시간이 걸리고, 이는 merge할 때의 수많은 충돌을 야기하고 더 빈번하게 merge를 해야합니다.
* 디자인을 잘 적용하기 쉽습니다. 디자인과 코드 품질을 높이기 더 쉽습니다.
* 리뷰에 종속성이 줄어듭니다. self-contained한 변경 사항 하나를 보내는 것은 당신이 리뷰를 기다리는 동안 다음 작업을 할 수 있도록 합니다.
* 롤백이 더 쉽습니다. 거대한 CL은 CL의 시작부터 롤백되기 전까지 업데이트 되는 다양한 파일을 건들 확률이 훨씬 높습니다. 이는 롤백을 더 어렵게 하고 중간의 CL들도 함께 롤백될 필요가 있을 것입니다.

리뷰어는 당신의 CL에 대해서 단순히 너무 크다는 이유만으로도 거절할 수 있는 선택권이 있다는 것을 명심하세요. 보통 그들은 당신의 노력에 대해 감사하지만 어떻게든 이것들을 더 작은 여러개의 변화로 변경하는 것을 요청할 수 있습니다. 이미 만들어진 변경 사항을 분리하는 것은 많은 시간이 걸리고 리뷰어에게 왜 이 거대한 변경 사항을 적용해야 하는지에 대한 논의에도 더 많은 시간을 사용하게 됩니다. 처음부터 작은 CL들을 쓰는 것이 더 쉽습니다.

<h3>무엇이 작은 CL일까요?</h3>
일반적으로 CL의 적당한 크기는 one self-contained change입니다. 이것은 무엇을 의미하냐면:

* CL은 오직 하나의 것을 다루기 위한 최소한의 변경이여야 합니다. 이것은 보통 feature 전첵가 아니라 feature의 하나의 부분입니다. 일반적으로 CL이 너무 작다 또는 크다에 대한 의견에서 마찰이 있는 것이 좋습니다. 어떤 크기가 적당한지 알기 위해 리뷰어들과 함께 일을 진행해라.
* 리뷰어가 CL에 대해서 이해하기 위해 필요한 모든 것은 현재 CL, description, code, 또는 이미 확인된 리뷰에 있어야 한다.
* 변경 사항이 적용되었을 때, 시스템이 잘 동작해야 한다.
* CL이 너무 작아서 영향력을 판단할 수 없는 수준이어선 안 된다. 만약 새로운 API를 추가했다면 API의 사용처 또한 동일한 CL에 존재해야 한다. 따라서 리뷰어는 사용될 API를 더 잘 이해할 수 있다. 이는 또한 필요 없는 API를 만드는 작업도 방지한다.

"매우 크다"를 결정하는 어려운 방법도 없고 빠른 방법도 없다. 100줄은 보통 합리적인 크기로 여겨지고 1000줄은 보통 크다고 여겨진다. 하지만 이는 모두 당신의 리뷰어에게 달려있다. 변경된 파일의 수도 크기에서 고려해야 한다. 200줄이 변경된 하나의 파일은 괜찮다. 하지만 조금씩 바뀐 50개의 파일이라면 이는 너무 크다.

당신은 당신의 코드에 익숙하지만, 리뷰어는 그렇지 않다는 것을 명심해라. 당신에게 적당해보이는 CL의 크기가 다른 리뷰어에게는 그렇지 않을 수 있다. 이런 의심이 든다면 더 작은 CL로 만들어라. 리뷰어들은 CL이 작다고 불평하지는 않는다.

<h3>언제 큰 CL도 괜찮을까?</h3>
몇 가지 큰 CL이 나쁘지 않은 상황이 있다.

* 단지 한 줄 바뀐 것으로 수정된 파일의 갯수가 늘어난 경우. 이는 리뷰어에게 그렇게 많은 시간을 빼앗지 않는다.
* 때로 거대한 CL들은 당신이 신뢰하고 있는 자동화 리팩토링 툴들에 의해서 만들어진다. 그리고 리뷰어의 역할은 간단한 점검과 개발자들이 그 변화를 원했는지 물어보는 것이다. 이런 CL들은 더 커질 수 있다. 물론 위의 권고 사항들은 적용되어야 한다.

<h4>파일 그릅으로 나누기</h4>
또 다른 CL을 나누는 방법은 파일을 그룹화하는 것이다. 이 파일들은 다른 리뷰어를 요구할 수도 있고 아니면 self-contained한 변화가 될 수도 있다.

예시: 당신이 protocol buffer에 대한 CL을 하나 보내고, 이 proto buffer를 사용하는 또 다른 CL을 보낸다. 당신은 두 번째 CL을 보내기 전에 첫 번째 CL이 먼저 제출되어야 하지만 그들은 동시에 리뷰될 수 있다. 이 경우에 그들이 당신의 변경 사항에 대해 명확히 파악하기 위해 당신은 양측 리뷰어에게 서로 다른 CL에 대한 정보를 줘야할 것이다.

다른 예시: 당신이 코드를 변경하는 하나의 CL을 보내고, 다른 하나는 이 코드를 사용하는 configuration 또는 실험이라고 해보자. 이것은 롤백을 하기가 더 쉽고 필요하다면 configuration 또는 실험 파일이 code보다 먼저 production에 push 될 수도 있다.

<h3>리팩토링을 분리해라</h3>
리팩토링을 feature changne 또는 bug fix와는 분리하는 것이 좋다. 예를 들어, class를 이동하거나 이름을 변경하는 작업은 해당 class내의 bug를 수정하는 작업과 분리되어야 한다. 그들이 분리되었을 때 각 CL의 변화에 대해 리뷰어가 더 이해하기 쉬워진다.

작은 변화 정도는 하나의 CL에서 함께 진행할 수도 있다. 하지만 리팩토링이 너무 커서 리뷰어에게 하나의 CL에서 작업을 하는 것이 어려운지에 대한 판단은 개발자와 리뷰어에게 달려있다. 

<h3>관련된 test code는 하나의 CL에서 진행해라</h3>
Test code를 다른 CL에서 진행하는 것을 피해라. 당신의 코드 수정을 점검하는 test 코드는 수정된 코드와 언제나 함께 있어야 한다.

하지만, 독립적인 테스트 수정은 다른 CL을 통해서 먼저 진행될 수도 있다. 이 경우는:

* 이미 존재하고, 제출된 코드를 점검할 때
* 테스트 코드를 리팩토링할 때
* 거대한 테스트 프레임워크 코드를 도입할 때

<h3>Build 할 수 있도록 해라</h3>
만약 다른 CL들이 서로에게 종속이 있다면, 당신은 CL 중 하나가 push 되더라도 시스템이 계속 동작할 수 있는 방법을 찾아야 한다. 그렇지 않다면 당신은 당신의 또다른 CL이 push되기 전까지 다른 개발자들은 계속된 시스템 build 실패를 경험하게 할 것이다.(만약 당신의 또다른 CL에 문제가 있다면 이 과정은 훨씬 길어질 것이다.)

<h3>더 이상 작게 만들 수 없을 때</h3>
때로 당신은 CL이 커야만 하는 상황을 직면할 것입니다. 이것은 대부분 잘못된 것입니다. CL을 작게 쓰는 것이 연습된 사람이라면 거의 대부분 상황에서 CL을 작은 여러개로 바꿀 수 있습니다.

큰 CL을 만들기 전에, 리팩토링만 하는 CL을 먼저 진행하는 것이 더 깔끔한 진행을 가능하게 할지 고려해보아라. 당신의 팀원에게 말하고 누군가가 작은 CL들로 만드는 방법을 알고 있는지 찾아봐라.

거의 없을 상황이지만 만약 이 모든 선택지가 실패한다면 거대한 CL을 리뷰 받기 전에 리뷰어들이 준비할 수 있도록 리뷰어에게 동의를 구해라. 이런 상황에서는 리뷰가 길어질 수 있다는 것을 인지하고 버그가 생기지 않게 특히나 주의하며, test를 쓰는 것에 대해 매우 최선을 다 해야 한다.

<h1>나에게 하는 말</h1>

* 리뷰어는 당신의 CL에 대해서 단순히 너무 크다는 이유만으로도 거절할 수 있는 선택권이 있다.
* 작은 CL의 크기는 feature가 아니라 feature의 part 중 하나이다.
* 리팩토링을 분리해라. 가끔 별 것 아니겠지라는 생각으로 함께 변경하다가 나중에 보면 뭘 했는지 헷갈린 경험이 있다. 꼭 주의하자.
* 큰 CL이 될 수 밖에 없다 = 대부분 당신의 능력 부족이다.